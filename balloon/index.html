<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Vintage Balloon Shooting</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            touch-action: manipulation;
        }
        
        body {
            background-color: #f0e6d2;
            font-family: 'Courier New', monospace;
            color: #5a3e36;
            overflow: hidden;
            background-image: url('https://www.transparenttextures.com/patterns/old-map.png');
            height: 100vh;
            width: 100vw;
            display: flex;
            flex-direction: column;
        }
        
        #header {
            background-color: rgba(210, 180, 140, 0.9);
            padding: 10px;
            border-bottom: 4px solid #5a3e36;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .header-group {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .header-label {
            font-weight: bold;
            font-size: 14px;
        }
        
        .header-value {
            min-width: 40px;
            text-align: center;
        }
        
        #game-container {
            flex: 1;
            position: relative;
            width: 100%;
            overflow: hidden;
        }
        
        #game-canvas {
            display: block;
            background-color: #e8d8b5;
            width: 100%;
            height: 100%;
            touch-action: none;
        }
        
        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 10;
        }
        
        button {
            background-color: #8b5a2b;
            color: #f0e6d2;
            border: 2px solid #5a3e36;
            padding: 8px 15px;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        button:hover {
            background-color: #a67c52;
        }
        
        .meter {
            height: 10px;
            width: 60px;
            background-color: #ddd;
            border: 2px solid #5a3e36;
            position: relative;
        }
        
        .meter-fill {
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            transition: width 0.1s linear;
        }
        
        #chances-meter .meter-fill {
            background-color: #5a3e36;
            width: 100%;
        }
        
        #timer-meter .meter-fill {
            background-color: #8b4513;
            width: 100%;
        }
        
        #crosshair {
            position: absolute;
            width: 20px;
            height: 20px;
            pointer-events: none;
            transform: translate(-10px, -10px);
            display: none;
        }
        
        #crosshair::before, #crosshair::after {
            content: "";
            position: absolute;
            background-color: #5a3e36;
        }
        
        #crosshair::before {
            width: 2px;
            height: 20px;
            left: 9px;
            top: 0;
        }
        
        #crosshair::after {
            width: 20px;
            height: 2px;
            left: 0;
            top: 9px;
        }
        
        #tutorial {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(210, 180, 140, 0.95);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            z-index: 100;
        }
        
        #tutorial h2 {
            margin-bottom: 20px;
            color: #8b0000;
        }
        
        #tutorial-content {
            max-width: 500px;
            margin-bottom: 20px;
        }
        
        #tutorial-images {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 20px 0;
        }
        
        .tutorial-image {
            width: 120px;
            height: 120px;
            border: 3px solid #5a3e36;
            border-radius: 8px;
            background-color: #e8d8b5;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
        }
        
        .tutorial-text {
            font-size: 14px;
            margin-top: 5px;
        }
        
        .points-display {
            position: absolute;
            font-size: 24px;
            font-weight: bold;
            animation: pointsFloat 1s forwards;
            pointer-events: none;
            z-index: 50;
        }
        
        @keyframes pointsFloat {
            0% {
                transform: translateY(0);
                opacity: 1;
            }
            100% {
                transform: translateY(-50px);
                opacity: 0;
            }
        }
        
        #reset-scores-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 5px 10px;
            font-size: 12px;
            background-color: #8b0000;
        }
        
        #quit-btn {
            background-color: #8b0000;
        }
        
        @media (max-width: 600px) {
            #header {
                padding: 8px;
                gap: 5px;
            }
            
            .header-group {
                flex: 1;
                justify-content: center;
            }
            
            .header-label {
                font-size: 12px;
            }
            
            .header-value {
                font-size: 14px;
                min-width: 30px;
            }
            
            .meter {
                width: 40px;
            }
            
            button {
                padding: 6px 12px;
                font-size: 14px;
            }
            
            #reset-scores-btn {
                top: 5px;
                right: 5px;
                padding: 3px 6px;
                font-size: 10px;
            }
            
            #controls {
                flex-wrap: wrap;
                justify-content: center;
                width: 90%;
            }
        }
    </style>
</head>
<body>
    <div id="header">
        <div class="header-group">
            <span class="header-label">Score:</span>
            <span class="header-value" id="score">0</span>
        </div>
        
        <div class="header-group">
            <span class="header-label">High Score:</span>
            <span class="header-value" id="high-score">0</span>
        </div>
        
        <div class="header-group">
            <span class="header-label">Chances:</span>
            <div class="meter" id="chances-meter">
                <div class="meter-fill"></div>
            </div>
        </div>
        
        <div class="header-group">
            <span class="header-label">Time:</span>
            <div class="meter" id="timer-meter">
                <div class="meter-fill"></div>
            </div>
        </div>
        
        <button id="reset-scores-btn">Reset Scores</button>
    </div>

    <div id="game-container">
        <canvas id="game-canvas"></canvas>
        
        <div id="controls">
            <button id="pause-btn">Pause</button>
            <button id="restart-btn">Restart</button>
            <button id="quit-btn">Quit Game</button>
        </div>
        
        <div id="crosshair"></div>
        
        <div id="tutorial">
            <h2>Vintage Balloon Shooting</h2>
            
            <div id="tutorial-content">
                <p>Shoot the balloons before time runs out!</p>
                <p>Red: 2 points | Green: 7 points | Blue: 5 points | Black: 10 points</p>
                <p>Watch out for black bombs - they end the game!</p>
                <p>You have 5 chances with 10 seconds each.</p>
            </div>
            
            <div id="tutorial-images">
                <div>
                    <div class="tutorial-image" style="color: red;">ðŸŽˆ</div>
                    <div class="tutorial-text">2 points</div>
                </div>
                <div>
                    <div class="tutorial-image" style="color: green;">ðŸŽˆ</div>
                    <div class="tutorial-text">7 points</div>
                </div>
                <div>
                    <div class="tutorial-image" style="color: blue;">ðŸŽˆ</div>
                    <div class="tutorial-text">5 points</div>
                </div>
                <div>
                    <div class="tutorial-image" style="color: black; background-color: #ccc;">ðŸ’£</div>
                    <div class="tutorial-text">Game Over!</div>
                </div>
            </div>
            
            <button id="start-btn">Start Game</button>
        </div>
    </div>

    <script>
        // Game variables
        const canvas = document.getElementById('game-canvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('score');
        const highScoreDisplay = document.getElementById('high-score');
        const chancesMeter = document.getElementById('chances-meter').querySelector('.meter-fill');
        const timerMeter = document.getElementById('timer-meter').querySelector('.meter-fill');
        const pauseBtn = document.getElementById('pause-btn');
        const restartBtn = document.getElementById('restart-btn');
        const quitBtn = document.getElementById('quit-btn');
        const startBtn = document.getElementById('start-btn');
        const resetScoresBtn = document.getElementById('reset-scores-btn');
        const tutorialScreen = document.getElementById('tutorial');
        const crosshair = document.getElementById('crosshair');
        
        // Set canvas size
        function resizeCanvas() {
            const container = document.getElementById('game-container');
            canvas.width = container.clientWidth;
            canvas.height = container.clientHeight;
        }
        
        // Game state
        let score = 0;
        let highScore = localStorage.getItem('balloonHighScore') || 0;
        let chancesLeft = 5;
        let timeLeft = 10;
        let timer;
        let gamePaused = false;
        let gameActive = false;
        let balloons = [];
        let arrows = [];
        let lastBalloonTime = 0;
        let balloonInterval = 1500;
        let isMobile = false;
        
        // Balloon types and points
        const BALLOON_TYPES = [
            { color: 'red', points: 2 },
            { color: 'green', points: 7 },
            { color: 'blue', points: 5 },
            { color: 'black', points: 10, isBomb: true }
        ];
        
        // Initialize game
        function initGame() {
            resizeCanvas();
            window.addEventListener('resize', resizeCanvas);
            
            score = 0;
            chancesLeft = 5;
            timeLeft = 10;
            balloons = [];
            arrows = [];
            gameActive = true;
            gamePaused = false;
            pauseBtn.textContent = 'Pause';
            updateUI();
            startTimer();
            tutorialScreen.style.display = 'none';
            
            // Detect mobile
            isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            requestAnimationFrame(gameLoop);
        }
        
        // Game loop
        function gameLoop() {
            if (!gamePaused && gameActive) {
                update();
            }
            render();
            
            if (gameActive) {
                requestAnimationFrame(gameLoop);
            }
        }
        
        // Update game state
        function update() {
            const now = Date.now();
            
            // Spawn new balloons
            if (now - lastBalloonTime > balloonInterval) {
                spawnBalloon();
                lastBalloonTime = now;
            }
            
            // Update balloons
            for (let i = balloons.length - 1; i >= 0; i--) {
                const balloon = balloons[i];
                balloon.y -= balloon.speed;
                
                // Remove balloons that go off screen
                if (balloon.y + balloon.radius < 0) {
                    balloons.splice(i, 1);
                }
            }
            
            // Update arrows
            for (let i = arrows.length - 1; i >= 0; i--) {
                const arrow = arrows[i];
                arrow.x += arrow.speed * Math.cos(arrow.angle);
                arrow.y += arrow.speed * Math.sin(arrow.angle);
                
                // Remove arrows that go off screen
                if (arrow.x < 0 || arrow.x > canvas.width || arrow.y < 0 || arrow.y > canvas.height) {
                    arrows.splice(i, 1);
                } else {
                    // Check for collisions
                    checkCollisions(arrow);
                }
            }
        }
        
        // Render game
        function render() {
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw background
            ctx.fillStyle = '#e8d8b5';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Draw border
            ctx.strokeStyle = '#8b5a2b';
            ctx.lineWidth = 8;
            ctx.strokeRect(0, 0, canvas.width, canvas.height);
            
            // Draw balloons
            balloons.forEach(balloon => {
                ctx.save();
                ctx.translate(balloon.x, balloon.y);
                ctx.rotate(balloon.rotation);
                
                if (balloon.isBomb) {
                    // Draw bomb
                    ctx.beginPath();
                    ctx.arc(0, 0, balloon.radius, 0, Math.PI * 2);
                    ctx.fillStyle = '#333';
                    ctx.fill();
                    ctx.strokeStyle = '#000';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    
                    // Draw fuse
                    ctx.beginPath();
                    ctx.moveTo(balloon.radius/2, -balloon.radius/2);
                    ctx.lineTo(balloon.radius, -balloon.radius);
                    ctx.strokeStyle = '#8b0000';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    
                    // Draw bomb lines
                    ctx.beginPath();
                    ctx.arc(0, 0, balloon.radius * 0.7, 0, Math.PI * 2);
                    ctx.strokeStyle = '#666';
                    ctx.lineWidth = 1;
                    ctx.stroke();
                } else {
                    // Draw balloon body
                    ctx.beginPath();
                    ctx.arc(0, 0, balloon.radius, 0, Math.PI * 2);
                    ctx.fillStyle = balloon.color;
                    ctx.fill();
                    ctx.strokeStyle = balloon.color === 'red' ? '#8b0000' : 
                                      balloon.color === 'green' ? '#006400' : 
                                      '#00008b';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                    
                    // Draw balloon highlight
                    ctx.beginPath();
                    ctx.arc(-balloon.radius/3, -balloon.radius/3, balloon.radius/4, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(255, 255, 255, 0.7)';
                    ctx.fill();
                }
                
                // Draw balloon knot
                ctx.beginPath();
                ctx.moveTo(0, balloon.radius);
                ctx.lineTo(-5, balloon.radius + 10);
                ctx.lineTo(5, balloon.radius + 10);
                ctx.closePath();
                ctx.fillStyle = '#5a3e36';
                ctx.fill();
                
                ctx.restore();
            });
            
            // Draw arrows
            arrows.forEach(arrow => {
                ctx.save();
                ctx.translate(arrow.x, arrow.y);
                ctx.rotate(arrow.angle);
                
                // Draw arrow
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(-20, -5);
                ctx.lineTo(-20, 5);
                ctx.closePath();
                ctx.fillStyle = '#5a3e36';
                ctx.fill();
                
                // Draw arrow tip
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(10, 0);
                ctx.strokeStyle = '#8b5a2b';
                ctx.lineWidth = 3;
                ctx.stroke();
                
                ctx.restore();
            });
        }
        
        // Spawn a new balloon
        function spawnBalloon() {
            const radius = 20 + Math.random() * 20;
            const x = radius + Math.random() * (canvas.width - radius * 2);
            const y = canvas.height + radius;
            const speed = 1 + Math.random() * 2;
            const rotation = Math.random() * Math.PI * 2;
            
            // Randomly select balloon type (10% chance for bomb)
            const isBomb = Math.random() < 0.1;
            let balloonType;
            
            if (isBomb) {
                balloonType = BALLOON_TYPES.find(t => t.isBomb);
            } else {
                // Filter out bomb and select random normal balloon
                const normalBalloons = BALLOON_TYPES.filter(t => !t.isBomb);
                balloonType = normalBalloons[Math.floor(Math.random() * normalBalloons.length)];
            }
            
            balloons.push({
                x,
                y,
                radius,
                speed,
                rotation,
                color: balloonType.color,
                points: balloonType.points,
                isBomb: balloonType.isBomb || false
            });
        }
        
        // Show floating points
        function showPoints(x, y, points, color) {
            const pointsElement = document.createElement('div');
            pointsElement.className = 'points-display';
            pointsElement.textContent = `+${points}`;
            pointsElement.style.color = color;
            pointsElement.style.left = `${x}px`;
            pointsElement.style.top = `${y}px`;
            document.getElementById('game-container').appendChild(pointsElement);
            
            // Remove after animation
            setTimeout(() => {
                pointsElement.remove();
            }, 1000);
        }
        
        // Check for collisions between arrows and balloons
        function checkCollisions(arrow) {
            for (let i = balloons.length - 1; i >= 0; i--) {
                const balloon = balloons[i];
                const dx = arrow.x - balloon.x;
                const dy = arrow.y - balloon.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                
                if (distance < balloon.radius) {
                    if (balloon.isBomb) {
                        // Game over if bomb is hit
                        createExplosion(balloon.x, balloon.y);
                        endGame();
                        return;
                    } else {
                        // Add points for normal balloons
                        score += balloon.points;
                        updateUI();
                        
                        // Show floating points
                        showPoints(balloon.x, balloon.y, balloon.points, balloon.color);
                        // Create pop effect
                        createPopEffect(balloon.x, balloon.y, balloon.color);
                    }
                    
                    // Remove the balloon and arrow
                    balloons.splice(i, 1);
                    arrows.splice(arrows.indexOf(arrow), 1);
                    
                    return;
                }
            }
        }
        
        // Create pop effect
        function createPopEffect(x, y, color) {
            for (let i = 0; i < 10; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = 1 + Math.random() * 3;
                
                setTimeout(() => {
                    ctx.save();
                    ctx.beginPath();
                    ctx.arc(
                        x + Math.cos(angle) * speed * 10, 
                        y + Math.sin(angle) * speed * 10, 
                        2, 
                        0, 
                        Math.PI * 2
                    );
                    ctx.fillStyle = color;
                    ctx.fill();
                    ctx.restore();
                }, i * 30);
            }
        }
        
        // Create explosion effect for bomb
        function createExplosion(x, y) {
            for (let i = 0; i < 20; i++) {
                const angle = Math.random() * Math.PI * 2;
                const speed = 2 + Math.random() * 5;
                const size = 3 + Math.random() * 5;
                
                setTimeout(() => {
                    ctx.save();
                    ctx.beginPath();
                    ctx.arc(
                        x + Math.cos(angle) * speed * 10, 
                        y + Math.sin(angle) * speed * 10, 
                        size, 
                        0, 
                        Math.PI * 2
                    );
                    ctx.fillStyle = `hsl(${Math.random() * 60}, 100%, 50%)`;
                    ctx.fill();
                    ctx.restore();
                }, i * 30);
            }
        }
        
        // Start timer for current chance
        function startTimer() {
            clearInterval(timer);
            timeLeft = 10;
            updateTimerUI();
            
            timer = setInterval(() => {
                if (!gamePaused && gameActive) {
                    timeLeft -= 0.1;
                    updateTimerUI();
                    
                    if (timeLeft <= 0) {
                        endCurrentChance();
                    }
                }
            }, 100);
        }
        
        // End current chance
        function endCurrentChance() {
            clearInterval(timer);
            chancesLeft--;
            updateUI();
            
            if (chancesLeft <= 0) {
                endGame();
            } else {
                startTimer();
            }
        }
        
        // Update UI elements
        function updateUI() {
            scoreDisplay.textContent = score;
            highScoreDisplay.textContent = highScore;
            chancesMeter.style.width = `${(chancesLeft / 5) * 100}%`;
        }
        
        // Update timer UI
        function updateTimerUI() {
            timerMeter.style.width = `${(timeLeft / 10) * 100}%`;
        }
        
        // End game
        function endGame() {
            gameActive = false;
            clearInterval(timer);
            
            // Update high score
            if (score > highScore) {
                highScore = score;
                localStorage.setItem('balloonHighScore', highScore);
            }
            
            // Show tutorial screen again after delay
            setTimeout(() => {
                tutorialScreen.style.display = 'flex';
                startBtn.textContent = 'Play Again';
            }, 1500);
        }
        
        // Reset all scores
        function resetScores() {
            if (confirm('Are you sure you want to reset ALL scores? This cannot be undone.')) {
                localStorage.removeItem('balloonHighScore');
                highScore = 0;
                highScoreDisplay.textContent = '0';
            }
        }
        
        // Quit the game completely
        function quitGame() {
            if (confirm('Are you sure you want to quit the game completely?')) {
                // Try to close the window (may not work in all browsers due to security restrictions)
                try {
                    window.close();
                } catch (e) {
                    // If window.close() doesn't work, show a message
                    alert('Game will now exit. You can close this tab/window.');
                    // Alternatively, redirect to a blank page or home page
                    // window.location.href = 'about:blank';
                }
            }
        }
        
        // Event listeners
        function handleShoot(e) {
            if (gamePaused || !gameActive) return;
            
            let clientX, clientY;
            
            if (e.type === 'touchstart') {
                e.preventDefault();
                const touch = e.touches[0] || e.changedTouches[0];
                clientX = touch.clientX;
                clientY = touch.clientY;
            } else {
                clientX = e.clientX;
                clientY = e.clientY;
            }
            
            const rect = canvas.getBoundingClientRect();
            const mouseX = clientX - rect.left;
            const mouseY = clientY - rect.top;
            
            // Calculate angle from bottom center to mouse position
            const startX = canvas.width / 2;
            const startY = canvas.height;
            const angle = Math.atan2(mouseY - startY, mouseX - startX);
            
            arrows.push({
                x: startX,
                y: startY,
                angle,
                speed: 10
            });
        }
        
        function handleMouseMove(e) {
            const rect = canvas.getBoundingClientRect();
            crosshair.style.left = `${e.clientX - rect.left}px`;
            crosshair.style.top = `${e.clientY - rect.top}px`;
            crosshair.style.display = 'block';
        }
        
        function handleTouchMove(e) {
            e.preventDefault();
            const touch = e.touches[0] || e.changedTouches[0];
            const rect = canvas.getBoundingClientRect();
            crosshair.style.left = `${touch.clientX - rect.left}px`;
            crosshair.style.top = `${touch.clientY - rect.top}px`;
            crosshair.style.display = 'block';
        }
        
        canvas.addEventListener('mousemove', handleMouseMove);
        canvas.addEventListener('mouseleave', () => {
            crosshair.style.display = 'none';
        });
        canvas.addEventListener('click', handleShoot);
        
        // Touch events for mobile
        canvas.addEventListener('touchstart', handleShoot);
        canvas.addEventListener('touchmove', handleTouchMove);
        canvas.addEventListener('touchend', () => {
            crosshair.style.display = 'none';
        });
        
        pauseBtn.addEventListener('click', () => {
            if (!gameActive) return;
            
            gamePaused = !gamePaused;
            pauseBtn.textContent = gamePaused ? 'Resume' : 'Pause';
            
            if (!gamePaused && timeLeft > 0) {
                startTimer();
            }
        });
        
        restartBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to restart? Your current progress will be lost.')) {
                initGame();
            }
        });
        
        quitBtn.addEventListener('click', quitGame);
        
        startBtn.addEventListener('click', () => {
            initGame();
        });
        
        resetScoresBtn.addEventListener('click', resetScores);
        
        // Initial setup
        resizeCanvas();
        highScoreDisplay.textContent = highScore;
        window.addEventListener('resize', resizeCanvas);
    </script>
</body>
</html>
